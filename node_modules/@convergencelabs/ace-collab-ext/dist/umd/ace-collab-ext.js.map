{"version":3,"file":"ace-collab-ext.js","sources":["../../src/src/ts/AceSelectionMarker.ts","../../src/src/ts/AceMultiSelectionManager.ts","../../src/src/ts/AceCursorMarker.ts","../../src/src/ts/AceMultiCursorManager.ts","../../src/src/ts/AceRangeUtil.ts","../../src/src/ts/AceRadarViewIndicator.ts","../../src/src/ts/AceRadarView.ts","../../src/src/ts/AceViewportUtil.ts"],"sourcesContent":["import {Ace} from \"ace-builds\";\n\nexport interface ISelectionBounds {\n  height?: number;\n  width?: number;\n  top?: number;\n  left?: number;\n  bottom?: number;\n  right?: number;\n}\n\nexport class AceSelectionMarker implements Ace.MarkerLike {\n  public range: Ace.Range;\n  public type: string;\n  public renderer?: Ace.MarkerRenderer;\n  public clazz: string;\n  public inFront: boolean;\n  public id: number;\n\n  private _session: Ace.EditSession;\n  private readonly _label: string;\n  private readonly _color: string;\n  private _ranges: Ace.Range[];\n  private readonly _selectionId: string;\n  private readonly _id: string;\n  private readonly _markerElement: HTMLDivElement;\n\n  constructor(session: Ace.EditSession, selectionId: string, label: string, color: string, ranges: Ace.Range[]) {\n    this._session = session;\n    this._label = label;\n    this._color = color;\n    this._ranges = ranges || [];\n    this._selectionId = selectionId;\n    this._id = null;\n    this._markerElement = document.createElement(\"div\");\n  }\n\n  public update(_: string[], markerLayer: any, session: Ace.EditSession, layerConfig: any): void {\n    while (this._markerElement.hasChildNodes()) {\n      this._markerElement.removeChild(this._markerElement.lastChild);\n    }\n\n    this._ranges.forEach((range) => {\n      this._renderRange(markerLayer, session, layerConfig, range);\n    });\n\n    this._markerElement.remove();\n    markerLayer.elt(\"remote-selection\", \"\");\n    const parentNode = markerLayer.element.childNodes[markerLayer.i - 1] || markerLayer.element.lastChild;\n    parentNode.appendChild(this._markerElement);\n  }\n\n  public setSelection(ranges: Ace.Range[]): void {\n    if (ranges === undefined || ranges === null) {\n      this._ranges = [];\n    } else if (ranges instanceof Array) {\n      this._ranges = ranges;\n    } else {\n      this._ranges = [ranges];\n    }\n\n    this._forceSessionUpdate();\n  }\n\n  public getLabel(): string {\n    return this._label;\n  }\n\n  public selectionId(): string {\n    return this._selectionId;\n  }\n\n  public markerId(): string {\n    return this._id;\n  }\n\n  private _renderLine(bounds: ISelectionBounds): void {\n    const div = document.createElement(\"div\");\n    div.className = \"ace-multi-selection\";\n    div.style.backgroundColor = this._color;\n\n    if (typeof bounds.height === \"number\") {\n      div.style.height = `${bounds.height}px`;\n    }\n\n    if (typeof bounds.width === \"number\") {\n      div.style.width = `${bounds.width}px`;\n    }\n\n    if (typeof bounds.top === \"number\") {\n      div.style.top = `${bounds.top}px`;\n    }\n\n    if (typeof bounds.left === \"number\") {\n      div.style.left = `${bounds.left}px`;\n    }\n\n    if (typeof bounds.bottom === \"number\") {\n      div.style.bottom = `${bounds.bottom}px`;\n    }\n\n    if (typeof bounds.right === \"number\") {\n      div.style.right = `${bounds.right}px`;\n    }\n\n    this._markerElement.append(div);\n  }\n\n  private _renderRange(markerLayer: any, session: Ace.EditSession, layerConfig: any, range: Ace.Range): void {\n    const screenRange: Ace.Range = range.toScreenRange(session);\n\n    let height: number = layerConfig.lineHeight;\n    let top: number = markerLayer.$getTop(screenRange.start.row, layerConfig);\n    let width: number = 0;\n    const right = 0;\n    const left: number = markerLayer.$padding + screenRange.start.column * layerConfig.characterWidth;\n\n    if (screenRange.isMultiLine()) {\n      // Render the start line\n      this._renderLine({height, right, top, left});\n\n      // from start of the last line to the selection end\n      top = markerLayer.$getTop(screenRange.end.row, layerConfig);\n      width = screenRange.end.column * layerConfig.characterWidth;\n      this._renderLine({height, width, top, left: markerLayer.$padding});\n\n      // all the complete lines\n      height = (screenRange.end.row - screenRange.start.row - 1) * layerConfig.lineHeight;\n      if (height < 0) {\n        return;\n      }\n      top = markerLayer.$getTop(screenRange.start.row + 1, layerConfig);\n      this._renderLine({height, right, top, left: markerLayer.$padding});\n    } else {\n      width = (range.end.column - range.start.column) * layerConfig.characterWidth;\n      this._renderLine({height, width, top, left});\n    }\n  }\n\n  private _forceSessionUpdate(): void {\n    (this._session as any)._signal(\"changeBackMarker\");\n  }\n}\n","import {Ace} from \"ace-builds\";\nimport {AceSelectionMarker} from \"./AceSelectionMarker\";\n\n/**\n * Implements multiple colored selections in the ace editor.  Each selection is\n * associated with a particular user. Each user is identified by a unique id\n * and has a color associated with them.  The selection manager supports block\n * selection through multiple AceRanges.\n */\nexport class AceMultiSelectionManager {\n\n  private readonly _selections: { [key: string]: AceSelectionMarker };\n  private readonly _session: Ace.EditSession;\n\n  /**\n   * Constructs a new AceMultiSelectionManager that is bound to a particular\n   * Ace EditSession instance.\n   *\n   * @param session\n   *   The Ace EditSession to bind to.\n   */\n  constructor(session: Ace.EditSession) {\n    this._selections = {};\n    this._session = session;\n  }\n\n  /**\n   * Adds a new collaborative selection.\n   *\n   * @param id\n   *   The unique system identifier for the user associated with this selection.\n   * @param label\n   *   A human readable / meaningful label / title that identifies the user.\n   * @param color\n   *   A valid css color string.\n   * @param ranges\n   *   An array of ace ranges that specify the initial selection.\n   */\n  public addSelection(id: string, label: string, color: string, ranges: Ace.Range[]): void {\n    if (this._selections[id] !== undefined) {\n      throw new Error(\"Selection with id already defined: \" + id);\n    }\n\n    const marker = new AceSelectionMarker(this._session, id, label, color, ranges);\n\n    this._selections[id] = marker;\n    this._session.addDynamicMarker(marker, false);\n  }\n\n  /**\n   * Updates the selection for a particular user.\n   *\n   * @param id\n   *   The unique identifier for the user.\n   * @param ranges\n   *   The array of ranges that specify the selection.\n   */\n  public setSelection(id: string, ranges: Ace.Range[]) {\n    const selection = this._getSelection(id);\n\n    selection.setSelection(ranges);\n  }\n\n  /**\n   * Clears the selection (but does not remove it) for the specified user.\n   * @param id\n   *   The unique identifier for the user.\n   */\n  public clearSelection(id: string): void {\n    const selection = this._getSelection(id);\n\n    selection.setSelection(null);\n  }\n\n  /**\n   * Removes the selection for the specified user.\n   * @param id\n   *   The unique identifier for the user.\n   */\n  public removeSelection(id: string) {\n    const selection = this._selections[id];\n\n    if (selection === undefined) {\n      throw new Error(\"Selection not found: \" + id);\n    }\n\n    // note: ace adds the id property to whatever marker you pass in.\n    this._session.removeMarker((selection as any).id);\n    delete this._selections[id];\n  }\n\n  /**\n   * Removes all selections.\n   */\n  public removeAll(): void {\n    Object.getOwnPropertyNames(this._selections).forEach((key) => {\n      this.removeSelection(this._selections[key].selectionId());\n    });\n  }\n\n  private _getSelection(id: string): AceSelectionMarker {\n    const selection: AceSelectionMarker = this._selections[id];\n\n    if (selection === undefined) {\n      throw new Error(\"Selection not found: \" + id);\n    }\n    return selection;\n  }\n}\n","import {Ace} from \"ace-builds\";\n\n/**\n * Represents a marker of a remote users cursor.\n */\nexport class AceCursorMarker implements Ace.MarkerLike {\n\n  public range: Ace.Range;\n  public type: string;\n  public renderer?: Ace.MarkerRenderer;\n  public clazz: string;\n  public inFront: boolean;\n  public id: number;\n\n  private readonly _session: Ace.EditSession;\n  private readonly _label: string;\n  private readonly _color: string;\n  private readonly _cursorId: string;\n  private readonly _id: string;\n  private readonly _markerElement: HTMLDivElement;\n  private readonly _cursorElement: HTMLDivElement;\n  private readonly _tooltipElement: HTMLDivElement;\n  private _visible: boolean;\n  private _position: Ace.Point;\n  private _tooltipTimeout: any;\n\n  /**\n   * Constructs a new AceCursorMarker\n   * @param session The Ace Editor Session to bind to.\n   * @param cursorId the unique id of this cursor.\n   * @param label The label to display over the cursor.\n   * @param color The css color of the cursor\n   * @param position The row / column coordinate of the cursor marker.\n   */\n  constructor(session: Ace.EditSession,\n              cursorId: string,\n              label: string,\n              color: string,\n              position: number | Ace.Point) {\n    this._session = session;\n    this._label = label;\n    this._color = color;\n    this._position = position ? this._convertPosition(position) : null;\n    this._cursorId = cursorId;\n    this._id = null;\n    this._visible = false;\n    this._tooltipTimeout = null;\n\n    // Create the HTML elements\n    this._markerElement = document.createElement(\"div\");\n    this._cursorElement = document.createElement(\"div\");\n    this._cursorElement.className = \"ace-multi-cursor\";\n    this._cursorElement.style.background = this._color;\n    this._markerElement.append(this._cursorElement);\n\n    this._tooltipElement = document.createElement(\"div\");\n    this._tooltipElement.className = \"ace-multi-cursor-tooltip\";\n    this._tooltipElement.style.background = this._color;\n    this._tooltipElement.style.opacity = \"0\";\n    this._tooltipElement.innerHTML = label;\n    this._markerElement.append(this._tooltipElement);\n  }\n\n  /**\n   * Called by Ace to update the rendering of the marker.\n   *\n   * @param _ The html to render, represented by an array of strings.\n   * @param markerLayer The marker layer containing the cursor marker.\n   * @param __ The ace edit session.\n   * @param layerConfig\n   */\n  public update(_: string[], markerLayer: any, __: Ace.EditSession, layerConfig: any): void {\n    if (this._position === null) {\n      return;\n    }\n\n    const screenPosition = this._session.documentToScreenPosition(\n      this._position.row, this._position.column);\n\n    const top: number = markerLayer.$getTop(screenPosition.row, layerConfig);\n    const left: number = markerLayer.$padding + screenPosition.column * layerConfig.characterWidth;\n    const height: number = layerConfig.lineHeight;\n\n    const cursorTop = top + 2;\n    const cursorHeight = height - 3;\n    const cursorLeft = left;\n    const cursorWidth = 2;\n\n    this._cursorElement.style.height = `${cursorHeight}px`;\n    this._cursorElement.style.width = `${cursorWidth}px`;\n    this._cursorElement.style.top = `${cursorTop}px`;\n    this._cursorElement.style.left = `${cursorLeft}px`;\n\n    let toolTipTop = cursorTop - height;\n    if (toolTipTop < 5) {\n      toolTipTop = cursorTop + height - 1;\n    }\n\n    const toolTipLeft = cursorLeft;\n    this._tooltipElement.style.top = `${toolTipTop - 2}px`;\n    this._tooltipElement.style.left = `${toolTipLeft - 2}px`;\n\n    // Remove the content node from whatever parent it might have now\n    // and add it to the new parent node.\n    this._markerElement.remove();\n    markerLayer.elt(\"remote-cursor\", \"\");\n    const parentNode = markerLayer.element.childNodes[markerLayer.i - 1] || markerLayer.element.lastChild;\n    parentNode.appendChild(this._markerElement);\n  }\n\n  /**\n   * Sets the location of the cursor marker.\n   * @param position The position of cursor marker.\n   */\n  public setPosition(position: number | Ace.Point): void {\n    this._position = this._convertPosition(position);\n    this._forceSessionUpdate();\n    this._tooltipElement.style.opacity = \"1\";\n    this._scheduleTooltipHide();\n  }\n\n  /**\n   * Sets the marker to visible / invisible.\n   *\n   * @param visible true if the marker should be displayed, false otherwise.\n   */\n  public setVisible(visible: boolean): void {\n    const old = this._visible;\n\n    this._visible = visible;\n    if (old !== this._visible) {\n      this._markerElement.style.visibility = visible ? \"visible\" : \"hidden\";\n      this._forceSessionUpdate();\n    }\n  }\n\n  /**\n   * Determines if the marker should be visible.\n   *\n   * @returns true if the cursor should be visible, false otherwise.\n   */\n  public isVisible(): boolean {\n    return this._visible;\n  }\n\n  /**\n   * Gets the unique id of this cursor.\n   * @returns the unique id of this cursor.\n   */\n  public cursorId(): string {\n    return this._cursorId;\n  }\n\n  /**\n   * Gets the id of the marker.\n   * @returns The marker id.\n   */\n  public markerId(): string {\n    return this._id;\n  }\n\n  /**\n   * Gets the label of the marker.\n   * @returns The marker\"s label.\n   */\n  public getLabel(): string {\n    return this._label;\n  }\n\n  private _forceSessionUpdate(): void {\n    (this._session as any)._signal(\"changeFrontMarker\");\n  }\n\n  private _convertPosition(position: number | Ace.Point): Ace.Point {\n    if (position === null) {\n      return null;\n    } else if (typeof position === \"number\") {\n      return this._session.getDocument().indexToPosition(position, 0);\n    } else if (typeof position.row === \"number\" && typeof position.column === \"number\") {\n      return position;\n    }\n\n    throw new Error(`Invalid position: ${position}`);\n  }\n\n  private _scheduleTooltipHide(): void {\n    if (this._tooltipTimeout !== null) {\n      clearTimeout(this._tooltipTimeout);\n    }\n\n    this._tooltipTimeout = setTimeout(() => {\n      this._tooltipElement.style.opacity = \"0\";\n      this._tooltipTimeout = null;\n    }, 2000);\n  }\n}\n","import {Ace} from \"ace-builds\";\nimport {AceCursorMarker} from \"./AceCursorMarker\";\n\n/**\n * Implements multiple colored cursors in the ace editor.  Each cursor is\n * associated with a particular user. Each user is identified by a unique id\n * and has a color associated with them.  Each cursor has a position in the\n * editor which is specified by a 2-d row and column ({row: 0, column: 10}).\n */\nexport class AceMultiCursorManager {\n\n  private readonly _cursors: { [key: string]: AceCursorMarker };\n  private readonly _session: Ace.EditSession;\n\n  /**\n   * Constructs a new AceMultiCursorManager that is bound to a particular\n   * Ace EditSession instance.\n   *\n   * @param session\n   *   The Ace EditSession to bind to.\n   */\n  constructor(session: Ace.EditSession) {\n    this._cursors = {};\n    this._session = session;\n  }\n\n  /**\n   * Adds a new collaborative selection.\n   *\n   * @param id\n   *   The unique system identifier for the user associated with this selection.\n   * @param label\n   *   A human readable / meaningful label / title that identifies the user.\n   * @param color\n   *   A valid css color string.\n   * @param position\n   *   A 2-d position or linear index indicating the location of the cursor.\n   */\n  public addCursor(id: string, label: string, color: string, position: number | Ace.Point): void {\n    if (this._cursors[id] !== undefined) {\n      throw new Error(`Cursor with id already defined: ${id}`);\n    }\n\n    const marker: AceCursorMarker = new AceCursorMarker(this._session, id, label, color, position);\n\n    this._cursors[id] = marker;\n    this._session.addDynamicMarker(marker, true);\n  }\n\n  /**\n   * Updates the selection for a particular user.\n   *\n   * @param id\n   *   The unique identifier for the user.\n   * @param position\n   *   A 2-d position or linear index indicating the location of the cursor.\n   */\n  public setCursor(id: string, position: number | Ace.Point): void {\n    const cursor: AceCursorMarker = this._getCursor(id);\n\n    cursor.setPosition(position);\n  }\n\n  /**\n   * Clears the cursor (but does not remove it) for the specified user.\n   *\n   * @param id\n   *   The unique identifier for the user.\n   */\n  public clearCursor(id: string): void {\n    const cursor = this._getCursor(id);\n\n    cursor.setPosition(null);\n  }\n\n  /**\n   * Removes the cursor for the specified user.\n   *\n   * @param id\n   *   The unique identifier for the user.\n   */\n  public removeCursor(id: string): void {\n    const cursor = this._cursors[id];\n\n    if (cursor === undefined) {\n      throw new Error(`Cursor not found: ${id}`);\n    }\n    // Note: ace adds an id field to all added markers.\n    this._session.removeMarker((cursor as any).id);\n    delete this._cursors[id];\n  }\n\n  /**\n   * Removes all cursors.\n   */\n  public removeAll(): void {\n    Object.getOwnPropertyNames(this._cursors).forEach((key) => {\n      this.removeCursor(this._cursors[key].cursorId());\n    });\n  }\n\n  private _getCursor(id: string): AceCursorMarker {\n    const cursor: AceCursorMarker = this._cursors[id];\n\n    if (cursor === undefined) {\n      throw new Error(`Cursor not found: ${id}`);\n    }\n    return cursor;\n  }\n}\n","import {Ace, Range} from \"ace-builds\";\n\nexport interface IRangeData {\n  start: {row: number, column: number};\n  end: {row: number, column: number};\n}\n\n/**\n * A helper class for working with Ace Ranges.\n */\nexport class AceRangeUtil {\n\n  public static rangeToJson(range: Ace.Range): IRangeData {\n    return {\n      start: {\n        row: range.start.row,\n        column: range.start.column\n      },\n      end: {\n        row: range.end.row,\n        column: range.end.column\n      }\n    };\n  }\n\n  public static jsonToRange(range: IRangeData): Ace.Range {\n    return new Range(\n      range.start.row,\n      range.start.column,\n      range.end.row,\n      range.end.column);\n  }\n\n  public static rangesToJson(ranges: Ace.Range[]): IRangeData[] {\n    return ranges.map((range) => {\n      return AceRangeUtil.rangeToJson(range);\n    });\n  }\n\n  public static jsonToRanges(ranges: IRangeData[]): Ace.Range[] {\n    return ranges.map((range) => {\n      return AceRangeUtil.jsonToRange(range);\n    });\n  }\n\n  public static toJson(value: Ace.Range): IRangeData;\n  public static toJson(value: Ace.Range[]): IRangeData[];\n  public static toJson(value: Ace.Range | Ace.Range[]) {\n    if (Array.isArray(value)) {\n      return AceRangeUtil.rangesToJson(value);\n    }\n\n    return AceRangeUtil.rangeToJson(value);\n  }\n\n  public static fromJson(value: IRangeData): Ace.Range;\n  public static fromJson(value: IRangeData[]): Ace.Range[];\n  public static fromJson(value: IRangeData | IRangeData[]): Ace.Range | Ace.Range[] {\n    if (Array.isArray(value)) {\n      return AceRangeUtil.jsonToRanges(value);\n    }\n\n    return AceRangeUtil.jsonToRange(value);\n  }\n}\n","import {Ace} from \"ace-builds\";\nimport {IRowRange} from \"./RowRange\";\n\nexport class AceRadarViewIndicator {\n\n  private readonly _label: string;\n  private readonly _color: string;\n  private readonly _editorListener: () => void;\n  private readonly _scrollElement: HTMLDivElement;\n  private readonly _cursorElement: HTMLDivElement;\n  private readonly _wrapper: HTMLDivElement;\n  private _viewRows: IRowRange;\n  private _cursorRow: number;\n  private _editor: Ace.Editor;\n  private _docLineCount: number;\n\n  constructor(label: string, color: string, viewRows: IRowRange, cursorRow: number, editor: Ace.Editor) {\n    this._label = label;\n    this._color = color;\n    this._viewRows = viewRows;\n    this._cursorRow = cursorRow;\n    this._editor = editor;\n    this._docLineCount = editor.getSession().getLength();\n\n    this._editorListener = () => {\n      const newLineCount = this._editor.getSession().getLength();\n\n      if (newLineCount !== this._docLineCount) {\n        this._docLineCount = newLineCount;\n        this.update();\n      }\n    };\n    this._editor.on(\"change\", this._editorListener);\n\n    this._scrollElement = document.createElement(\"div\");\n    this._scrollElement.className = \"ace-radar-view-scroll-indicator\";\n\n    this._scrollElement.style.borderColor = this._color;\n    this._scrollElement.style.background = this._color;\n\n    // todo implement a custom tooltip for consistent presentation.\n    this._scrollElement.title = this._label;\n\n    this._scrollElement.addEventListener(\"click\", () => {\n      const middle = ((this._viewRows.end - this._viewRows.start) / 2) + this._viewRows.start;\n\n      this._editor.scrollToLine(middle, true, false, () => { /* no-op */\n      });\n    }, false);\n\n    this._cursorElement = document.createElement(\"div\");\n    this._cursorElement.className = \"ace-radar-view-cursor-indicator\";\n    this._cursorElement.style.background = this._color;\n    this._cursorElement.title = this._label;\n\n    this._cursorElement.addEventListener(\"click\", () => {\n      this._editor.scrollToLine(this._cursorRow, true, false, () => { /* no-op */\n      });\n    }, false);\n\n    this._wrapper = document.createElement(\"div\");\n    this._wrapper.className = \"ace-radar-view-wrapper\";\n    this._wrapper.style.display = \"none\";\n\n    this._wrapper.appendChild(this._scrollElement);\n    this._wrapper.appendChild(this._cursorElement);\n  }\n\n  public element(): HTMLDivElement {\n    return this._wrapper;\n  }\n\n  public setCursorRow(cursorRow: number): void {\n    this._cursorRow = cursorRow;\n    this.update();\n  }\n\n  public setViewRows(viewRows: IRowRange): void {\n    this._viewRows = viewRows;\n    this.update();\n  }\n\n  public update(): void {\n    if (!_isSet(this._viewRows) && !_isSet(this._cursorRow)) {\n      this._wrapper.style.display = \"none\";\n    } else {\n      this._wrapper.style.display = null;\n      const maxLine = this._docLineCount - 1;\n\n      if (!_isSet(this._viewRows)) {\n        this._scrollElement.style.display = \"none\";\n      } else {\n        const topPercent = Math.min(maxLine, this._viewRows.start) / maxLine * 100;\n        const bottomPercent = 100 - (Math.min(maxLine, this._viewRows.end) / maxLine * 100);\n\n        this._scrollElement.style.top = topPercent + \"%\";\n        this._scrollElement.style.bottom = bottomPercent + \"%\";\n        this._scrollElement.style.display = null;\n      }\n\n      if (!_isSet(this._cursorRow)) {\n        this._cursorElement.style.display = \"none\";\n      } else {\n        const cursorPercent = Math.min(this._cursorRow, maxLine) / maxLine;\n        const ratio = (this._wrapper.offsetHeight - this._cursorElement.offsetHeight) / this._wrapper.offsetHeight;\n        const cursorTop = cursorPercent * ratio * 100;\n\n        this._cursorElement.style.top = cursorTop + \"%\";\n        this._cursorElement.style.display = null;\n      }\n    }\n  }\n\n  public dispose(): void {\n    this._wrapper.parentNode.removeChild(this._wrapper);\n    this._editor.off(\"change\", this._editorListener);\n  }\n}\n\nfunction _isSet(value: any): boolean {\n  return value !== undefined && value !== null;\n}\n","import {Ace} from \"ace-builds\";\nimport {AceRadarViewIndicator} from \"./AceRadarViewIndicator\";\nimport {IRowRange} from \"./RowRange\";\n\n/**\n * Implements viewport awareness in the Ace Editor by showing where remote\n * users are scrolled too and where there cursor is in the document, even\n * if the cursor is not in view.\n */\nexport class AceRadarView {\n  private readonly _views: { [key: string]: AceRadarViewIndicator };\n  private readonly _editor: Ace.Editor;\n  private _container: HTMLElement;\n\n  /**\n   * Constructs a new AceRadarView bound to the supplied element and editor.\n   *\n   * @param element\n   *          The HTML Element that the AceRadarView should render to.\n   * @param editor\n   *          The Ace Editor to listen to events from.\n   */\n  constructor(element: HTMLElement | string, editor: Ace.Editor) {\n    this._container = null;\n    if (typeof element === \"string\") {\n      this._container = document.getElementById(element);\n    } else {\n      this._container = element;\n    }\n\n    this._container.style.position = \"relative\";\n    this._views = {};\n    this._editor = editor;\n  }\n\n  /**\n   * Add a view indicator for a new remote user.\n   *\n   * @param id\n   *          The unique id of the user.\n   * @param label\n   *          A text label to displAce for the user.\n   * @param color\n   *          The color to render the indicator with.\n   * @param viewRows\n   *          The rows the user's viewport spans.\n   * @param cursorRow\n   *          The row that the user's cursor is on.\n   */\n  public addView(id: string, label: string, color: string, viewRows: IRowRange, cursorRow: number) {\n    const indicator = new AceRadarViewIndicator(\n      label,\n      color,\n      viewRows,\n      cursorRow,\n      this._editor\n    );\n\n    this._container.appendChild(indicator.element());\n    indicator.update();\n\n    this._views[id] = indicator;\n  }\n\n  /**\n   * Determines if the AceRadarView has an indicator for this specified user.\n   *\n   * @param id\n   *          The id of the user to check for.\n   * @returns\n   *   True if the AceRadarView has an indicator for this user, false otherwise.\n   */\n  public hasView(id: string): boolean {\n    return this._views[id] !== undefined;\n  }\n\n  /**\n   * Sets the view row span for a particular user.\n   *\n   * @param id\n   *          The id of the user to set the rows for.\n   * @param rows\n   *          The row range to set.\n   */\n  public setViewRows(id: string, rows: IRowRange) {\n    const indicator = this._views[id];\n    indicator.setViewRows(rows);\n  }\n\n  /**\n   * Sets the cursor row for a particular user.\n   *\n   * @param id\n   *          The id of the user to set the cursor row for.\n   * @param row\n   *          The row to set.\n   */\n  public setCursorRow(id: string, row: number) {\n    const indicator = this._views[id];\n    indicator.setCursorRow(row);\n  }\n\n  /**\n   * Clears the view for a particular user, causing their indicator to disapear.\n   * @param id\n   *   The id of the user to clear.\n   */\n  public clearView(id: string): void {\n    const indicator = this._views[id];\n    indicator.setCursorRow(null);\n    indicator.setViewRows(null);\n  }\n\n  /**\n   * Removes the view indicator for the specified user.\n   * @param id\n   *   The id of the user to remove the view indicator for.\n   */\n  public removeView(id: string): void {\n    const indicator = this._views[id];\n    indicator.dispose();\n    delete this._views[id];\n  }\n}\n","import {Ace} from \"ace-builds\";\nimport {IIndexRange} from \"./IndexRange\";\nimport {IRowRange} from \"./RowRange\";\n\nexport class AceViewportUtil {\n\n  public static getVisibleIndexRange(editor: Ace.Editor): IIndexRange {\n    let firstRow: number = editor.getFirstVisibleRow();\n    let lastRow: number = editor.getLastVisibleRow();\n\n    if (!editor.isRowFullyVisible(firstRow)) {\n      firstRow++;\n    }\n\n    if (!editor.isRowFullyVisible(lastRow)) {\n      lastRow--;\n    }\n\n    const startPos: number = editor.getSession().getDocument().positionToIndex({row: firstRow, column: 0}, 0);\n\n    // todo, this should probably be the end of the row\n    const endPos: number = editor.getSession().getDocument().positionToIndex({row: lastRow, column: 0}, 0);\n\n    return {\n      start: startPos,\n      end: endPos\n    };\n  }\n\n  public static indicesToRows(editor: Ace.Editor, startIndex: number, endIndex: number): IRowRange {\n    const startRow: number = editor.getSession().getDocument().indexToPosition(startIndex, 0).row;\n    const endRow: number = editor.getSession().getDocument().indexToPosition(endIndex, 0).row;\n\n    return {\n      start: startRow,\n      end: endRow\n    };\n  }\n}\n"],"names":["Range"],"mappings":"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"}