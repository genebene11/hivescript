{"version":3,"file":"AceRadarViewIndicator.js","sourceRoot":"","sources":["../../src/ts/AceRadarViewIndicator.ts"],"names":[],"mappings":"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","sourcesContent":["import {Ace} from \"ace-builds\";\nimport {IRowRange} from \"./RowRange\";\n\nexport class AceRadarViewIndicator {\n\n  private readonly _label: string;\n  private readonly _color: string;\n  private readonly _editorListener: () => void;\n  private readonly _scrollElement: HTMLDivElement;\n  private readonly _cursorElement: HTMLDivElement;\n  private readonly _wrapper: HTMLDivElement;\n  private _viewRows: IRowRange;\n  private _cursorRow: number;\n  private _editor: Ace.Editor;\n  private _docLineCount: number;\n\n  constructor(label: string, color: string, viewRows: IRowRange, cursorRow: number, editor: Ace.Editor) {\n    this._label = label;\n    this._color = color;\n    this._viewRows = viewRows;\n    this._cursorRow = cursorRow;\n    this._editor = editor;\n    this._docLineCount = editor.getSession().getLength();\n\n    this._editorListener = () => {\n      const newLineCount = this._editor.getSession().getLength();\n\n      if (newLineCount !== this._docLineCount) {\n        this._docLineCount = newLineCount;\n        this.update();\n      }\n    };\n    this._editor.on(\"change\", this._editorListener);\n\n    this._scrollElement = document.createElement(\"div\");\n    this._scrollElement.className = \"ace-radar-view-scroll-indicator\";\n\n    this._scrollElement.style.borderColor = this._color;\n    this._scrollElement.style.background = this._color;\n\n    // todo implement a custom tooltip for consistent presentation.\n    this._scrollElement.title = this._label;\n\n    this._scrollElement.addEventListener(\"click\", () => {\n      const middle = ((this._viewRows.end - this._viewRows.start) / 2) + this._viewRows.start;\n\n      this._editor.scrollToLine(middle, true, false, () => { /* no-op */\n      });\n    }, false);\n\n    this._cursorElement = document.createElement(\"div\");\n    this._cursorElement.className = \"ace-radar-view-cursor-indicator\";\n    this._cursorElement.style.background = this._color;\n    this._cursorElement.title = this._label;\n\n    this._cursorElement.addEventListener(\"click\", () => {\n      this._editor.scrollToLine(this._cursorRow, true, false, () => { /* no-op */\n      });\n    }, false);\n\n    this._wrapper = document.createElement(\"div\");\n    this._wrapper.className = \"ace-radar-view-wrapper\";\n    this._wrapper.style.display = \"none\";\n\n    this._wrapper.appendChild(this._scrollElement);\n    this._wrapper.appendChild(this._cursorElement);\n  }\n\n  public element(): HTMLDivElement {\n    return this._wrapper;\n  }\n\n  public setCursorRow(cursorRow: number): void {\n    this._cursorRow = cursorRow;\n    this.update();\n  }\n\n  public setViewRows(viewRows: IRowRange): void {\n    this._viewRows = viewRows;\n    this.update();\n  }\n\n  public update(): void {\n    if (!_isSet(this._viewRows) && !_isSet(this._cursorRow)) {\n      this._wrapper.style.display = \"none\";\n    } else {\n      this._wrapper.style.display = null;\n      const maxLine = this._docLineCount - 1;\n\n      if (!_isSet(this._viewRows)) {\n        this._scrollElement.style.display = \"none\";\n      } else {\n        const topPercent = Math.min(maxLine, this._viewRows.start) / maxLine * 100;\n        const bottomPercent = 100 - (Math.min(maxLine, this._viewRows.end) / maxLine * 100);\n\n        this._scrollElement.style.top = topPercent + \"%\";\n        this._scrollElement.style.bottom = bottomPercent + \"%\";\n        this._scrollElement.style.display = null;\n      }\n\n      if (!_isSet(this._cursorRow)) {\n        this._cursorElement.style.display = \"none\";\n      } else {\n        const cursorPercent = Math.min(this._cursorRow, maxLine) / maxLine;\n        const ratio = (this._wrapper.offsetHeight - this._cursorElement.offsetHeight) / this._wrapper.offsetHeight;\n        const cursorTop = cursorPercent * ratio * 100;\n\n        this._cursorElement.style.top = cursorTop + \"%\";\n        this._cursorElement.style.display = null;\n      }\n    }\n  }\n\n  public dispose(): void {\n    this._wrapper.parentNode.removeChild(this._wrapper);\n    this._editor.off(\"change\", this._editorListener);\n  }\n}\n\nfunction _isSet(value: any): boolean {\n  return value !== undefined && value !== null;\n}\n"]}